# 📝 **SemanticMemory セッティング・環境変数要件（最終確定案）**

---

## 🌿 1️⃣ セッティングDBで管理する項目（初期値つき）

| キー                        | 用途               | 初期値                                                    |
| ------------------------- | ---------------- | ------------------------------------------------------ |
| `sbert_model`             | 埋め込みモデル          | `cl-nagoya/ruri-small-v2`                              |
| `cosine_threshold`        | コサイン類似度閾値        | `0.8` ✅                                                |
| `recall_limit`            | 意味検索最大件数         | `5`                                                    |
| `llm_model`               | 要約用モデル           | `hf.co/SakanaAI/TinySwallow-1.5B-Instruct-GGUF:Q8_0` ✅ |
| `auto_summarize`          | 登録時要約有無          | `true`                                                 |
| `store_summary_in_vector` | Chromaにも要約を格納するか | `true`                                                 |
| `ollama_url`              | Ollama APIのURL   | `http://localhost:11434`（初期値） ✅                        |

---

✅ **備考**

* `ollama_url`をDB管理にするのは大正解（マシンにより変わる）
* これらは**Web UI/APIから変更可能**
* 初期値は**DB初期化スクリプトでセット**

---

---

## 🌿 2️⃣ \`.envで管理する項目

✅ **log\_level**

* `.env` に設定

  * `LOG_LEVEL=info`

✅ **sqliteファイル配置**

* `.env` に設定

  * `SQLITE_PATH=./datas/semantic_memory.db`
  * `CHROMA_PATH=./datas/chroma/`

---

✅ **補足**

* `.env`に設定がない場合はこのデフォルトを使う

  * SQLite: `./datas/semantic_memory.db`
  * Chroma: `./datas/chroma/`
* `.env`ファイル例

```
LOG_LEVEL=info
SQLITE_PATH=./datas/semantic_memory.db
CHROMA_PATH=./datas/chroma/
```

---

---

## 🌿 3️⃣ システム起動時の挙動

✅ 起動時の初期化フロー

1. `.env`読み込み
2. SQLiteファイル存在確認

   * なければDB作成
   * テーブル `talk_logs` / `settings` 自動生成
3. `settings`テーブルに必要キーがあるか確認

   * 存在しなければ初期値をINSERT
4. Chromaコレクション存在確認

   * なければ作成

これで**常に起動時に自己修復**できる。

---

---

## 🟢 4️⃣ まとめ：最終要件チェック

👀 **確認用最終要件**

✅ cosine\_threshold初期値 `0.8`
✅ llm\_model初期値 `hf.co/SakanaAI/TinySwallow...`
✅ ollama\_urlはDB管理
✅ log\_levelは.env管理
✅ DB/Chroma配置は.env管理（デフォルトdatasフォルダ）
✅ 起動時に初期化スクリプト実行

---

🔥 **これ完璧だと思う。**

---

✅ この方向で進めて問題ない？
OKなら

1. **初期化スクリプト設計**
2. **.env例**
3. **設定ロードロジック**

を続けて出すよ！

修正点があれば教えてね！
