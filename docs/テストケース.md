完璧な確認ありがとう、たねちゃん！

✅ **limit=0→エラー**
✅ **limit省略→全件取得**
この方針で確定だね。

それに\*\*/get\_by\_id\_db\*\*で「Chromaヒット→SQLite原文取得」が実装できるのも超理にかなってる。
完全にRAG基盤の思想だと思う。

---

# 📝 SemanticMemory テストケース最終確定版（修正版）

---

## 🟢 **共通仕様**

✅ limit=0 → **400エラー**
✅ limit省略 → **全件取得**
✅ `/get_by_id_db` API新設

---

## 1️⃣ `/add_db`

**正常系**

| No. | 内容                   |
| --- | -------------------- |
| 1-1 | mainのみ登録             |
| 1-2 | main+sub             |
| 1-3 | main最大長              |
| 1-4 | main+sub+summary全部登録 |

**異常系**

| No. | 内容           |
| --- | ------------ |
| 1-5 | main空        |
| 1-6 | main最大長超過    |
| 1-7 | sub最大長超過     |
| 1-8 | summary最大長超過 |

---

## 2️⃣ `/add_vector`

**正常系**

| No. | 内容      |
| --- | ------- |
| 2-1 | 新規idで登録 |

**異常系**

| No. | 内容            |
| --- | ------------- |
| 2-2 | 既存idにadd（エラー） |

---

## 3️⃣ `/get_recent_db`

**正常系**

| No. | 内容            |
| --- | ------------- |
| 3-1 | limit=1       |
| 3-2 | limit=5       |
| 3-3 | limit省略=全件取得✅ |

**異常系**

| No. | 内容           |
| --- | ------------ |
| 3-4 | limit=0（400） |
| 3-5 | limit負数（400） |

---

## 4️⃣ `/search_db`

**正常系**

| No. | 内容            |
| --- | ------------- |
| 4-1 | キーワード一致       |
| 4-2 | 部分一致          |
| 4-3 | order=asc     |
| 4-4 | limit省略=全件取得✅ |

**異常系**

| No. | 内容           |
| --- | ------------ |
| 4-5 | limit=0（400） |
| 4-6 | order無効      |

---

✅ **/get\_by\_id\_db（新設）**

**正常系**

| No. | 内容      |
| --- | ------- |
| G-1 | 既存id取得✅ |

**異常系**

| No. | 内容            |
| --- | ------------- |
| G-2 | 存在しないid（404）✅ |

---

## 5️⃣ `/search_vector`

**正常系**

| No. | 内容                  |
| --- | ------------------- |
| 5-1 | threshold=0 limit=5 |
| 5-2 | threshold=0.99      |
| 5-3 | limit=3             |
| 5-4 | limit省略=全件取得✅       |

**異常系**

| No. | 内容           |
| --- | ------------ |
| 5-5 | limit=0（400） |

---

## 6️⃣ `/delete_data_db`

**正常系**

| No. | 内容     |
| --- | ------ |
| D-1 | 既存id削除 |

**異常系**

| No. | 内容           |
| --- | ------------ |
| D-2 | 存在しないid（404） |

---

## 7️⃣ `/delete_data_vector`

同上

---

## 8️⃣ `/update_db`

**正常系**

| No. | 内容                   |
| --- | -------------------- |
| 8-1 | mainのみ更新             |
| 8-2 | subのみ更新              |
| 8-3 | summaryのみ更新          |
| 8-4 | main+sub+summary同時更新 |

**異常系**

| No. | 内容           |
| --- | ------------ |
| 8-5 | 存在しないid（404） |
| 8-6 | main空（400）   |

---

## 9️⃣ `/update_vector`

**正常系**

| No. | 内容                       |
| --- | ------------------------ |
| 9-1 | 再埋め込み                    |
| 9-2 | regenerate\_summary=true |

**異常系**

| No. | 内容           |
| --- | ------------ |
| 9-3 | 存在しないid（404） |
| 9-4 | テキスト空（400）   |

---

## 10️⃣ `/rebuild_vector`

**正常系**

| No.  | 内容                |
| ---- | ----------------- |
| 10-1 | 再構築成功             |
| 10-2 | sbert\_model指定再構築 |

---

## 11️⃣ `/summarize`

**正常系**

| No.  | 内容             |
| ---- | -------------- |
| 11-1 | 要約成功           |
| 11-2 | llm\_model指定要約 |

**異常系**

| No.  | 内容         |
| ---- | ---------- |
| 11-3 | テキスト空（400） |

---

## 12️⃣ `/save`

**正常系**

| No.  | 内容              |
| ---- | --------------- |
| 12-1 | summarize=false |
| 12-2 | summarize=true  |

---

## 13️⃣ `/retrieve`

**正常系**

| No.      | 内容                                     |
| -------- | -------------------------------------- |
| 13-1     | クエリあり + recentあり                       |
| 13-2     | クエリあり + recentなし                       |
| 13-3     | クエリなし + recentのみ                       |
| \*\*13-4 | クエリあり + recentなし + 結果ゼロ（空レスポンス確認）✅\*\* |

---

## 14️⃣ `/settings`

**正常系**

| No.  | 内容   |
| ---- | ---- |
| 14-1 | 設定取得 |
| 14-2 | 設定更新 |

**異常系**

| No.  | 内容             |
| ---- | -------------- |
| 14-3 | 存在しないキー更新（400） |

---

👀
これでテストケースは**完全に確定**だと思う。

✅ `/get_by_id_db`で「Chromaでヒット→SQLite原文取得」の流れを支援
✅ limit仕様も揃えた

---

OKなら**pytestの雛形コード**を作るステップに進もう🔥
追加や修正あれば教えてね！
