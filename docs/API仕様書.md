# ğŸ“˜ SemanticMemory APIä»•æ§˜æ›¸ï¼ˆæœ€çµ‚FIXç‰ˆï¼‰

---

## ğŸŒ¿ 1. å‘½åè¦å‰‡

âœ… **æ¥é ­è¾ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰**

| æ¥é ­è¾           | æ©Ÿèƒ½    |
| ------------- | ----- |
| `add`         | æ–°è¦ç™»éŒ²  |
| `get_recent`  | æ™‚ç³»åˆ—å–å¾— |
| `search`      | æ¤œç´¢    |
| `delete_data` | å‰Šé™¤    |
| `update`      | æ›´æ–°    |
| `rebuild`     | å…¨å†æ§‹ç¯‰  |

---

âœ… **æœ«å°¾ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¨®åˆ¥ï¼‰**

| æœ«å°¾        | å¯¾è±¡                 |
| --------- | ------------------ |
| `_db`     | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«DB (SQLite) |
| `_vector` | ãƒ™ã‚¯ãƒˆãƒ«DB (Chroma)    |

---

âœ… **è¤‡åˆAPI**

| åç§°         | æ©Ÿèƒ½        |
| ---------- | --------- |
| `save`     | ä¸¡DBåŒæ™‚ç™»éŒ²   |
| `retrieve` | ä¸¡DBã‹ã‚‰ä½µåˆå–å¾— |

---

---

## ğŸŸ¢ 2. å˜æ©Ÿèƒ½API

---

### ğŸ“— 2.1 ãƒ‡ãƒ¼ã‚¿æ–°è¦ç™»éŒ² (SQLite)

#### `POST /add_db`

**æ¦‚è¦**
ä¸»ãƒ»å‰¯ãƒ†ã‚­ã‚¹ãƒˆã‚’DBã«ä¿å­˜ã€‚

**Body**

```json
{
  "main_text": "ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ",
  "sub_text": "ã‚µãƒ–ãƒ†ã‚­ã‚¹ãƒˆ(ä»»æ„)"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "saved",
  "id": 123
}
```

---

---

### ğŸ“— 2.2 ãƒ‡ãƒ¼ã‚¿æ–°è¦ç™»éŒ² (ãƒ™ã‚¯ãƒˆãƒ«DB)

#### `POST /add_vector`

**æ¦‚è¦**
ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ™ã‚¯ãƒˆãƒ«DBã«åŸ‹ã‚è¾¼ã¿ç™»éŒ²ã€‚

**Body**

```json
{
  "id": 123,
  "text": "åŸ‹ã‚è¾¼ã¿ãƒ†ã‚­ã‚¹ãƒˆ"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "vector_saved",
  "id": "123"
}
```

---

---

### ğŸ“— 2.3 æ™‚ç³»åˆ—å–å¾— (SQLite)

#### `GET /get_recent_db`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**

* `limit` (int): ä»¶æ•°

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
[
  {
    "id": 123,
    "main_text": "...",
    "sub_text": "...",
    "summary_text": "...",
    "create_time": "...",
    "update_time": "..."
  }
]
```

---

---

### ğŸ“— 2.4 å…¨æ–‡æ¤œç´¢ (SQLite)

#### `GET /search_db`

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**

* `q` (string): ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
* `order` (`asc`/`desc`)
* `limit` (int)

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
(ä¸Šã¨åŒã˜)

---

---

### ğŸ“— 2.5 æ„å‘³æ¤œç´¢ (ãƒ™ã‚¯ãƒˆãƒ«DB)

#### `POST /search_vector`

**Body**

```json
{
  "query": "ã‚¯ã‚¨ãƒªãƒ†ã‚­ã‚¹ãƒˆ",
  "threshold": 0.6,
  "limit": 5
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
[
  {
    "id": "123",
    "text": "ä¸€è‡´ãƒ†ã‚­ã‚¹ãƒˆ",
    "score": 0.88
  }
]
```

---

---

### ğŸ“— 2.6 ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ (SQLite)

#### `DELETE /delete_data_db`

**Body**

```json
{
  "id": 123
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "deleted",
  "id": 123
}
```

---

---

### ğŸ“— 2.7 ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ (ãƒ™ã‚¯ãƒˆãƒ«DB)

#### `DELETE /delete_data_vector`

**Body**

```json
{
  "id": "123"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "vector_deleted",
  "id": "123"
}
```

---

---

### ğŸ“— 2.8 ãƒ‡ãƒ¼ã‚¿ç·¨é›† (SQLite)

#### `PATCH /update_db`

**Body**

```json
{
  "id": 123,
  "main_text": "ä¿®æ­£ãƒ†ã‚­ã‚¹ãƒˆ(ä»»æ„)",
  "sub_text": "ä¿®æ­£ãƒ†ã‚­ã‚¹ãƒˆ(ä»»æ„)",
  "summary_text": "ä¿®æ­£è¦ç´„(ä»»æ„)"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "updated",
  "id": 123
}
```

---

---

### ğŸ“— 2.9 ãƒ‡ãƒ¼ã‚¿ç·¨é›† (ãƒ™ã‚¯ãƒˆãƒ«DB)

#### `POST /update_vector`

**æ¦‚è¦**
å‰Šé™¤ï¼‹å†åŸ‹ã‚è¾¼ã¿

**Body**

```json
{
  "id": "123",
  "text": "æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆ",
  "regenerate_summary": true
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "vector_updated",
  "id": "123"
}
```

---

---

### ğŸ“— 2.10 å†æ§‹ç¯‰ (ãƒ™ã‚¯ãƒˆãƒ«DB)

#### `POST /rebuild_vector`

**æ¦‚è¦**
å…¨å†åŸ‹ã‚è¾¼ã¿

**Body**

```json
{
  "sbert_model": "æ–°ãƒ¢ãƒ‡ãƒ«å",
  "regenerate_summary": true
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "rebuild_started"
}
```

---

---

### ğŸ“— 2.11 Ollamaè¦ç´„

#### `POST /summarize`

**Body**

```json
{
  "text": "è¦ç´„ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ",
  "llm_model": "ä»»æ„æŒ‡å®š(ã‚ªãƒ—ã‚·ãƒ§ãƒ³)"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "summary": "è¦ç´„çµæœ"
}
```

---

---

## ğŸŸ¢ 3. è¤‡åˆæ©Ÿèƒ½API

---

### ğŸ“˜ 3.1 ãƒ‡ãƒ¼ã‚¿åŒæ™‚ä¿å­˜

#### `POST /save`

**æ¦‚è¦**
SQLiteã¨ãƒ™ã‚¯ãƒˆãƒ«DBã«åŒæ™‚ä¿å­˜ã€‚

**Body**

```json
{
  "main_text": "ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ",
  "sub_text": "ã‚µãƒ–ãƒ†ã‚­ã‚¹ãƒˆ(ä»»æ„)",
  "summarize": true
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "saved",
  "id": 123
}
```

---

---

### ğŸ“˜ 3.2 ãƒ‡ãƒ¼ã‚¿ä½µåˆå–å¾—

#### `POST /retrieve`

**Body**

```json
{
  "query": "æ„å‘³æ¤œç´¢ã‚¯ã‚¨ãƒª",
  "threshold": 0.6,
  "limit": 5,
  "recent_limit": 5
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "semantic": [
    {"id":"...", "text":"...", "score":0.9}
  ],
  "recent": [
    {"id": "...", "main_text":"...", "sub_text":"..."}
  ]
}
```

---

---

## ğŸŸ¢ 4. è¨­å®šç®¡ç†API

---

### ğŸ“— 4.1 è¨­å®šå–å¾—

#### `GET /settings`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "sbert_model": "...",
  "llm_model": "...",
  "cosine_threshold": "...",
  "recall_limit": "..."
}
```

---

---

### ğŸ“— 4.2 è¨­å®šæ›´æ–°

#### `POST /settings`

**Body**

```json
{
  "key": "sbert_model",
  "value": "æ–°ãƒ¢ãƒ‡ãƒ«å"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "status": "updated",
  "key": "sbert_model"
}
```

---

---

## ğŸ“ 5. æ³¨æ„äº‹é …

* IDã¯**SQLiteãƒ»ãƒ™ã‚¯ãƒˆãƒ«DBå…±é€š**
* APIã¯å°†æ¥æ‹¡å¼µï¼ˆã‚¿ã‚°ç®¡ç†ã€è¤‡æ•°ãƒ¢ãƒ‡ãƒ«åŒæ™‚é‹ç”¨ï¼‰
* èªè¨¼ã¯æœªå®Ÿè£…ï¼ˆè‡ªå·±åˆ©ç”¨å‰æï¼‰
* `rebuild_vector`ã¯é•·æ™‚é–“å‡¦ç†

